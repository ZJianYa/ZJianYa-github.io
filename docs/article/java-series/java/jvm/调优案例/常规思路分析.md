
## 常规思路

完整逻辑:  
对 Linux 的监控，首先要确定是你的应用程序的问题，同长配合 top 等命令配合使用  
- 确定 网络 / IO / CPU 的问题  
- 确定是哪个 app 导致  

### TOP

```
  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                          
25135 elsearch  20   0 16.877g 542260      0 S   2.0  3.4 123:11.31 java                                                                                                             
 6636 root      20   0 9828.4m 300076    196 S   0.3  1.9  71:15.00 java                                                                                                             
 9835 elsearch  20   0 1741412 199992   5708 S   0.3  1.2  62:31.57 node                                                                                                             
 6033 systemd+  20   0 2699176 136332    168 S   0.0  0.8  24:15.61 mysqld                                                                                                           
 2418 root      20   0 1210860 125992   2440 S   0.0  0.8   5:20.09 gnome-software  
```

假如我们通过 top 命令确定了线程 25135 ，然后需要查看 25135 的详细信息，也就是 JVM 的运行情况。  

```
[root@localhost ~]# pidstat -w -p 25135 -t
Linux 3.10.0-862.11.6.el7.x86_64 (localhost.localdomain) 	08/20/2019 	_x86_64_	(28 CPU)

03:26:38 PM   UID      TGID       TID   cswch/s nvcswch/s  Command
03:26:38 PM  1000     25135         -      0.00      0.00  java
03:26:38 PM  1000         -     25135      0.00      0.00  |__java
03:26:38 PM  1000         -     25230      0.00      0.00  |__java
03:26:38 PM  1000         -     25231      0.00      0.00  |__GC
03:26:38 PM  1000         -     25232      0.00      0.00  |__CMS
03:26:38 PM  1000         -     25233      0.27      0.00  |__CMS
03:26:38 PM  1000         -     25234      0.20      0.00  |__VM
03:26:38 PM  1000         -     25235      0.00      0.00  |__Reference
03:26:38 PM  1000         -     25236      0.00      0.00  |__Finalizer
03:26:38 PM  1000         -     25237      0.00      0.00  |__Signal
03:26:38 PM  1000         -     25238      0.04      0.00  |__C2
03:26:38 PM  1000         -     25239      0.04      0.00  |__C1
03:26:38 PM  1000         -     25240      0.01      0.00  |__Sweeper
03:26:38 PM  1000         -     25244      0.00      0.00  |__Service
03:26:38 PM  1000         -     25245      3.86      0.00  |__VM
03:26:38 PM  1000         -     25246      0.00      0.00  |__Common-Cleaner
03:26:38 PM  1000         -     25251      0.00      0.00  |__process
03:26:38 PM  1000         -     25255      0.00      0.00  |__GC
03:26:38 PM  1000         -     25256      0.00      0.00  |__GC
...
03:26:38 PM  1000         -     25275      0.00      0.00  |__CMS
03:26:38 PM  1000         -     25276      0.00      0.00  |__CMS
03:26:38 PM  1000         -     25277      0.00      0.00  |__CMS
03:26:38 PM  1000         -     25278      0.00      0.00  |__CMS
03:26:38 PM  1000         -     25281      1.02      0.00  |__elasticsearch[n
03:26:38 PM  1000         -     25285      0.43      0.00  |__elasticsearch[n
03:26:38 PM  1000         -     25289      0.02      0.00  |__Connection
03:26:38 PM  1000         -     25290      0.42      0.00  |__ticker-schedule
03:26:38 PM  1000         -     25292      0.00      0.00  |__ml-cpp-log-tail
03:26:38 PM  1000         -     25294      0.03      0.00  |__elasticsearch[n
03:26:38 PM  1000         -     25295      0.19      0.00  |__elasticsearch[n
...
```

### jstack

/usr/bin/jdk1.8.0_202/bin/jstack 25135 > /usr/dump

[elsearch@localhost ~]$ tail dump 
"CMS Thread#2" os_prio=0 cpu=9.15ms elapsed=949141.92s tid=0x00007f3960002800 nid=0x62bc runnable  

"CMS Thread#3" os_prio=0 cpu=9.16ms elapsed=949141.92s tid=0x00007f3960004800 nid=0x62bd runnable  

"CMS Thread#4" os_prio=0 cpu=9.05ms elapsed=949141.93s tid=0x00007f3960006800 nid=0x62be runnable  

"VM Periodic Task Thread" os_prio=0 cpu=582537.77ms elapsed=949143.91s tid=0x00007f398c241000 nid=0x629d waiting on condition  

JNI global refs: 40, weak refs: 44

> 如果不使用的进程的用户执行 jstack ，可能出现异常： jstack well-known file xxx is not secure: file should be owned by the current user (which is 0) but is owned by userId

