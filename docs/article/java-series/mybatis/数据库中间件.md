
数据库中间件，要解决的几个问题：

## 提供更好的数据库访问  

除了应用层面，其他全是业务无关性的东西。  

  - 几个数据库访问的概念  
    - 数据源  
    - 会话  
    - 事务，一个事务可以跨多个请求/响应  
    - 一次请求  
  - 应用层面  
    - 并不关心下层是几个会话，也不关心几次请求，但是会关心是不是一个事务  
    - 用户的请求/响应，一次请求必然会在一个线程中完成  
    - 一个请求可能跨数据源  
  - 中间件实现逻辑和优化
    - （会话）连接池
    - 底层会话和上层请求的关系是 1:N 还是 M:N ？  
      1:N 是一个比较好的方法，但是即便是 1:N ，也需要考虑底层会话的线程安全。  
      一个线程在使用过程中，另一个线程是不能使用的。如何保证正确的“释放连接”，这个并不太容易确定。  
      “获取和释放链接”的单元是语句级别，还是事务级别，还是线程生命周期？我理解的是事务级别，当然更多的时候其实做到语句级别会更好。  
    - 如果采用了读写分离  
      读写分离和分库分表，从某种程度上讲都是出现了 M:N 的情况，而事实上我们还是可以分解为 1:N 的情况处理。  
      当然这肯定会引起一些问题，比如并发不够好。  
    - 如果采用了分库分表  

## 提供更好的 ORM 

其实这有点像语言自动翻译的功能了，也可能这就是语言自动翻译的功能。  
语言翻译其实本质上也是一种映射，需要你对两种语言十分的精通。计算机语言其实还是好很多的，毕竟语法十分严苛而明确。  
自然语言处理翻译做的再好，也可能无法避免犯错，一个是自然语言的语境十分复杂，一个是自然语言本身就是容易有各种错误，也会有各种方言，还有的是自然语言本身就容易出现歧义，而且即便是人也会理解错误。  

### ORM框架 选择

我们始终不太同意使用JPA的原因是： querydsl 没有SQL好。  
http://www.querydsl.com  
http://www.eclipse.org/eclipselink/  Java Persistence Query Language  
https://www.sojson.com/blog/294.html Springboot JPA 执行原生sql ，自定义SQL占位符增加参数 JPA简单了解 spring.jpa.show-sql=true  

从某种程度上讲，JPA还是可以提供相对于Mybatis的一些便捷性。主要是减少了大量的配置文件。

https://blog.jooq.org/tag/mybatis/  
http://jdbi.org/ jdbi 3 guide
http://www.mybatis.org/mybatis-3/java-api.html  